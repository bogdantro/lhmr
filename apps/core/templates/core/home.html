{% extends 'core/base.html' %}
{% load static %}


{% block content %}
<link rel="stylesheet" href="{% static '/scss/store/base.css' %}" type="text/css">
<script rel="stylesheet" src="{% static '/js/home.js' %}" type="text/javascript"></script>
<script rel="stylesheet" src="{% static '/js/scroll.js' %}" type="text/javascript"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Sniglet&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Alata&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
<link href='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css' rel='stylesheet' />
<script src='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js'></script>
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.9/mapbox-gl-draw.js'></script>
<script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>

<!-- Cover -->
<div class="cover">
   <div class="width">
      <img src="{% static 'images/covers/cover-main.jpg' %}" alt="" class="cover-img-lillehammer">
      <div class="content" id="coverContent">
         <div class="text">
            <h1 class="cover-heading">Finn den tjenesten du trenger i Lillehammer</h1>
            <p class="paragraph">
               Enkel og grei løsning til å finne de tjenestene du trenger på noen få klikk
            </p>
         </div>
         <div class="cover-search">
            <form id="searchForm" action="{% url 'home_page_search' %}" method="GET">
               {% csrf_token %}
               <input name="q" type="text" placeholder="Søk blant 500 tjenester"><i class="fa-solid fa-magnifying-glass"></i>
               <button type="submit">Søk etter tjeneste</button>
           </form>
         </div>
      </div>
   </div>
</div>

<!-- Services -->
<div class="services">
   <div class="content">
      <div class="text">
         <p class="headingp">Endres hver onsdag</p>
         <h1 class="section-heading">Utvalgte tjenester</h1>
      </div>
      <div class="services-cards">
         {% for product in products %}
         <div class="service" onclick="window.location.href='{% url  'product_detail' product.slug  %}'">
            <img src="{{product.image.url}}" alt="" class="service-image">
            <div class="reviews">
               <p><i class="fa-solid fa-star"></i>3</p><span>(40)</span>
            </div>
            <div class="name">{{product.name}}</div>
            <div class="business-name">{{product.business_name}}</div>
            <button>Les mer</button>
         </div>
         {% endfor %}
      </div>
   </div>
</div>

<!-- Categories -->
<div class="categories">
   <div class="content">
      <div class="text">
         <p class="headingp">Kategorier</p>
         <h1 class="section-heading">Topp kategorier</h1>
      </div>
      <div class="cat-cards">
         {% for category in category %}
            <div class="cat">
               <div class="icon"><i class="{{category.icon}}"></i></div>
               <div class="text">
                  <h1>{{category.name}}</h1>
                  <p>{{category.short_des}}</p>
               </div>
            </div>
            {% endfor %}
      </div>
   </div>
</div>

<!-- Map -->
<div class="map">
   <div class="content">
      <div class="text">
         <p class="headingp">Kart</p>
         <h1 class="section-heading">Utforsk med kart</h1>
      </div>
     <div id="map" style="width: 100%; height: 450px; margin-top: 13px;"></div>
   </div>
</div>

<script type="text/javascript">
   mapboxgl.accessToken = '{{mapbox_access_token}}';
    const map = new mapboxgl.Map({
      container: 'map', // Specify the container ID
      style: 'mapbox://styles/bogdantro/cld3lse3v000301lidywd9qfs',
      center: [ 10.462281, 61.113568], // Specify the starting position
      zoom: 11, // Specify the starting zoom
    });
  
    /* 
  Add an event listener that runs
    when a user clicks on the map element.
  */
  map.on('click', (event) => {
    // If the user clicked on one of your markers, get its information.
    const features = map.queryRenderedFeatures(event.point, {
      layers: ['lillehammer'] // replace with your layer name
    });
    if (!features.length) {
      return;
    }
    const feature = features[0];
  
    // Code from the next step will go here.
    /* 
      Create a popup, specify its options 
      and properties, and add it to the map.
    */
  const popup = new mapboxgl.Popup({ offset: [0, -15] })
    .setLngLat(feature.geometry.coordinates)
    .setHTML(
      `<h3>${feature.properties.title}</h3><p>${feature.properties.description}</p>`
    )
    .addTo(map);
  });
  </script>
  
{% endblock %}