{% extends 'core/base.html' %}
{% load static %}




{% block content %}
<link rel="stylesheet" href="{% static '/scss/page/pages.css' %}" type="text/css">
<link rel="stylesheet" href="{% static '/scss/store/product/product.css' %}" type="text/css">
<script rel="stylesheet" src="{% static '/js/product.js' %}" type="text/javascript"></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css' rel='stylesheet' />
<script src='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js'></script>
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.9/mapbox-gl-draw.js'></script>
<script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>

<!-- Only on some pages -->
   <div class="product-search" id="productSearch">
    <form id="searchForm" action="{% url 'home_page_search' %}" method="GET">
       {% csrf_token %}
       <input name="q" type="text" placeholder="Søk blant 500 tjenester"><button type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
   </form>
 </div>
 <div class="page">
     <div class="product-section">
        <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
              <div class="carousel-item active">
                <img class="product-image" src="{{product.image.url}}" alt="product image">
              </div>
              <div class="carousel-item">
                <img class="product-image" src="{{product.image.url}}" alt="product image">
              </div>
              <div class="carousel-item">
                <img class="product-image" src="{{product.image.url}}" alt="product image">
              </div>
            </div>
            <a data-slide="prev" role="button" class="carousel-control-prev" href="#carouselExampleControls">&#10094;</a>
            <a data-slide="next" role="button" class="carousel-control-next" href="#carouselExampleControls">&#10095;</a>
          </div>
          <div class="quick-links" id="quickLinks">
            <a id="infoQucikLink" onclick="info()" class="active">Info</a>
            <a id="reviewsQucikLink" onclick="reviews()">Vurderinger</a>
            <a id="contactQucikLink" onclick="contact()">Kontakt</a>
          </div>
         <div class="text main">
             <div class="reviews">
                 <p><i class="fa-solid fa-star"></i>{% for review in product.reviews.all %}{{review.stars}}{% endfor %}</p><span>(40)</span>
                </div>
                <div class="name">{{product.name}}</div>
                <div class="business-name"><i class="fa-solid fa-circle-user"></i>{{product.business_name}}</div>
          </div>

          <div id="infoSec">            
            <div class="text info" id="infoAbtServ">
                <h1>Beskrivelse</h1>
              <p class="">{{product.description}}</p>
            </div>
            
            <hr style="margin-block: 38px;">
            
            <div class="text location" id="location">
              <h1>Plassering</h1>
              <p>{{product.address}}</p>
              <div id='map' style="width: 100%; height: 330px;"></div>
            </div>

            <hr style="margin-block: 38px;">
            
            <div class="text opening-hours" id="openingHours">
              <h1>Åpningstider</h1>
              <div class="card">
                <div class="day monday">
                  <p class="act-day">Mandag</p>
                  <p class="time">{{product.monday}}</p>
                </div>
                <hr style="margin-block: 11px; background: rgba(194, 194, 194, 0.45);">
                <div class="day tuesday">
                  <p class="act-day">Tirsdag</p>
                  <p class="time">12:00 - 20:00</p>
                </div>
                <hr style="margin-block: 11px; background: rgba(194, 194, 194, 0.45);">
                <div class="day wednesday">
                  <p class="act-day">Ondsdag</p>
                  <p class="time">12:00 - 20:00</p>
                </div>
                <hr style="margin-block: 11px; background: rgba(194, 194, 194, 0.45);">
                <div class="day thursday">
                  <p class="act-day">Torsdag</p>
                  <p class="time">12:00 - 20:00</p>
                </div>
                <hr style="margin-block: 11px; background: rgba(194, 194, 194, 0.45);">
                <div class="day friday">
                  <p class="act-day">Fredag</p>
                  <p class="time">12:00 - 20:00</p>
                </div>
                <hr style="margin-block: 11px; background: rgba(194, 194, 194, 0.45);">
                <div class="day saturday">
                  <p class="act-day">Lørdag</p>
                  <p class="time">12:00 - 20:00</p>
                </div>
                <hr style="margin-block: 11px; background: rgba(194, 194, 194, 0.45);">
                <div class="day sunday">
                  <p class="act-day">Søndag</p>
                  <p class="time">12:00 - 20:00</p>
                </div>
              </div>
            </div>
          </div>

          <div id="reviewsSec">
            <div class="text reviews" id="reviewsServ">
              <h1>Vurderinger</h1>
              {% for review in product.reviews.all %}
              <div id="reviewCard">
                <div class="stars"><p><i class="fa-solid fa-star"></i>{{ review.stars }} av 6</p></div>
                <h1 class="title">{{ review.title }}</h1>
                <p class="date">Skrevet: {{ review.created_at|date:"d-m-Y" }} - Anonymt</p>
                <p class="content">{{ review.content }}</p>
                <br>
                {% if review.is_conf %}
                <p class="conf"><i class="fa-solid fa-circle-check"></i>Vurderingen har blitt bekrefta</p>
                {% endif %}
              </div>
              {% empty %}
               <p class="no-reviews">Ingen vurderinger enda</p>
               {% endfor %}
               <button class="add-review-btn">Skriv en vurdering</button>
               <p class="add-review-txt">For å kunne publisere vurderingen, må vi bekrefte den. Dette tar ca 1-10 timer etter du har skrevet vurderingen</p>
            </div>
          </div>

          <div id="contactSec">
            <div class="text contact" id="contactServ">
              <h1>Kontakt</h1>
              <a href="">www.domain.no</a>
              <br>
              <a href="">Facebook</a>
              <br>
              <a href="">Instagram</a>
            </div>
          </div>
        </div>
      </div>

<script type="text/javascript">
 mapboxgl.accessToken = '{{mapbox_access_token}}';
  const map = new mapboxgl.Map({
    container: 'map', // Specify the container ID
    style: 'mapbox://styles/bogdantro/cld3lse3v000301lidywd9qfs',
    center: ['{{product.cords1}}', '{{product.cords2}}'], // Specify the starting position
    zoom: 13, // Specify the starting zoom
  });

  /* 
Add an event listener that runs
  when a user clicks on the map element.
*/
map.on('click', (event) => {
  // If the user clicked on one of your markers, get its information.
  const features = map.queryRenderedFeatures(event.point, {
    layers: ['lillehammer'] // replace with your layer name
  });
  if (!features.length) {
    return;
  }
  const feature = features[0];

  // Code from the next step will go here.
  /* 
    Create a popup, specify its options 
    and properties, and add it to the map.
  */
const popup = new mapboxgl.Popup({ offset: [0, -15] })
  .setLngLat(feature.geometry.coordinates)
  .setHTML(
    `<h3>${feature.properties.title}</h3><p>${feature.properties.description}</p>`
  )
  .addTo(map);
});
</script>

<br>
<br>
{% endblock %}